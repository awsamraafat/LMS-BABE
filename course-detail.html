<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุชูุงุตูู ุงูุฏูุฑุฉ - ููุตุฉ ูุญููุฏ ูุณ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo" style="text-decoration:none">
                <img src="pic/logo.png" alt="Logo">
            </a>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="index.html#home" class="nav-link">ุงูุฑุฆูุณูุฉ</a>
                </li>
                <li class="nav-item">
                    <a href="index.html#courses" class="nav-link">ุงูุฏูุฑุงุช</a>
                </li>
                <li class="nav-item">
                    <a href="index.html#about" class="nav-link">ูู ูุญู</a>
                </li>
            </ul>
            <div class="nav-actions">
                <div id="userMenu" class="user-menu" style="display: none;">
                    <div class="user-info">
                        <img src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='40' fill='%23667eea'/><text x='50' y='60' text-anchor='middle' fill='white' font-size='40'>๐ค</text></svg>" alt="User" class="user-avatar">
                        <span class="user-name">ุฃุญูุฏ ูุญูุฏ</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="user-dropdown">
                        <a href="dashboard.html" class="dropdown-item">
                            <i class="fas fa-tachometer-alt"></i>
                            ููุญุฉ ุงูุชุญูู
                        </a>
                        <hr>
                        <a href="#" id="logoutBtn" class="dropdown-item">
                            <i class="fas fa-sign-out-alt"></i>
                            ุชุณุฌูู ุงูุฎุฑูุฌ
                        </a>
                    </div>
                </div>
                <div id="authButtons" class="auth-buttons">
                    <button class="btn btn-outline" id="loginBtn">
                        <i class="fas fa-sign-in-alt"></i>
                        ุชุณุฌูู ุงูุฏุฎูู
                    </button>
                    <button class="btn btn-primary" id="registerBtn">
                        <i class="fas fa-user-plus"></i>
                        ุฅูุดุงุก ุญุณุงุจ
                    </button>
                </div>
            </div>
            <div class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <section class="courses" style="padding-top:110px">
        <div class="container">
            <div id="courseHeader" class="section-header">
                <h2 class="section-title">ุชูุงุตูู ุงูุฏูุฑุฉ</h2>
                <p class="section-subtitle"></p>
            </div>

            <div class="course-detail-grid" style="display:grid;grid-template-columns:1.5fr 1fr;gap:24px">
                <div>
                    <div class="video-wrapper" style="background:#000;border-radius:16px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,.1)">
                        <iframe id="player" width="100%" height="420" src="" title="Course player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>
                    <div id="lessonTitle" style="margin-top:12px;font-weight:700"></div>
                </div>
                <div>
                    <div class="content-card">
                        <div class="card-header"><h3>ูุงุฆูุฉ ุงูุฏุฑูุณ</h3></div>
                        <div id="lessonsList" class="course-list"></div>
                    </div>
                    <div id="examCard" class="content-card" style="margin-top:16px">
                        <div class="card-header"><h3 id="examCardTitle">ุงูุงูุชุญุงู</h3></div>
                        <div class="card-body" style="display:flex;flex-direction:column;gap:10px">
                            <div style="display:flex;align-items:center;justify-content:space-between">
                                <h4 id="examTitleText" style="margin:0">ุงูุชุญุงู ุงูุชูุงุถู ู ุงูุชูุงูู</h4>
                                <span style="opacity:.7"><i class="fas fa-clock"></i> 60 ุฏูููุฉ</span>
                            </div>
                            <button id="startExamBtn" class="btn btn-primary">
                                <i class="fas fa-clipboard-check"></i>
                                ุจุฏุก ุงูุงูุชุญุงู
                            </button>
                        </div>
                    </div>

                    
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-logo">
                        <img src="pic/logo.png" alt="Logo">
                    </div>
                    <p>ููุตุฉ ุชุนููููุฉ ูุชูุงููุฉ ููุฑูุงุถูุงุช ูุน ุฏูุฑุงุช ุชูุงุนููุฉ ูุดูุงุฏุงุช ูุนุชูุฏุฉ</p>
                    <div class="social-links">
                        <a href="https://www.facebook.com/MrAhmedEssam22" target="_blank" class="social-link">
                            <i class="fab fa-facebook"></i>
                        </a>
                        <a href="https://www.youtube.com/@Mahmoud.Yasien" target="_blank" class="social-link">
                            <i class="fab fa-youtube"></i>
                        </a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h3>ุงูุฏูุฑุงุช</h3>
                    <ul>
                        <li><a href="#">ูุฑุงุฌุนุฉ ุงูุงุญุตุงุก</a></li>
                        <li><a href="#">ุงูุฌุจุฑ ุงููุชูุฏู</a></li>
                        <li><a href="#">ุงูููุฏุณุฉ</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>ุงูุฎุฏูุงุช</h3>
                    <ul>
                        <li><a href="#">ุงูุฏูุฑุงุช ุงูุชูุงุนููุฉ</a></li>
                        <li><a href="#">ุงูุดูุงุฏุงุช ุงููุนุชูุฏุฉ</a></li>
                        <li><a href="#">ุงูุฏุนู ุงูููู</a></li>
                        <li><a href="#">ุงููุฌุชูุน ุงูุชุนูููู</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>ุงูุชูุงุตู</h3>
                    <ul>
                        <li><a href="https://www.facebook.com/MrAhmedEssam22" target="_blank">ุงูููุณุจูู</a></li>
                        <li><a href="https://www.youtube.com/@Mahmoud.Yasien" target="_blank">ุงูููุชููุจ</a></li>
                        <li><a href="mailto:info@mr-ahmedessam.online">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2024 ููุตุฉ ูุณุชุฑ ูุญููุฏ ูุณ. ุฌููุน ุงูุญููู ูุญููุธุฉ.</p>
                <p>ููุตุฉ ุชุนููููุฉ ูุชูุงููุฉ - ูุตุฑ</p>
            </div>
        </div>
    </footer>

    <script src="courses.js"></script>
    <script src="script.js"></script>
    <script>
    (function(){
        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');
        const course = window.COURSES && window.COURSES[id];
        const header = document.getElementById('courseHeader');
        const subtitle = header ? header.querySelector('.section-subtitle') : null;
        const titleEl = header ? header.querySelector('.section-title') : null;
        if (!course) {
            if (titleEl) titleEl.textContent = 'ุงูุฏูุฑุฉ ุบูุฑ ููุฌูุฏุฉ';
            if (subtitle) subtitle.textContent = '';
            return;
        }
        if (titleEl) titleEl.textContent = course.title;
        if (subtitle) subtitle.textContent = course.description;

        const player = document.getElementById('player');
        const lessonTitle = document.getElementById('lessonTitle');
        const lessonsList = document.getElementById('lessonsList');
        function play(lesson){
            if (!lesson) return;
            if (player) player.src = lesson.src;
            if (lessonTitle) lessonTitle.textContent = lesson.title + ' โข ' + lesson.duration;
            // Mark active
            lessonsList.querySelectorAll('.lesson-item').forEach(li=>li.classList.remove('active'));
            const active = lessonsList.querySelector(`[data-lesson-id="${lesson.id}"]`);
            if (active) active.classList.add('active');
            // Mark watched for progress
            try {
                const u = JSON.parse(localStorage.getItem('user'));
                if (u && window.UserData) {
                    window.UserData.markLessonWatched(u.id || u.email, course.id, lesson.id);
                }
            } catch(_) {}
        }
        // resolve lessons: if course.lessons non-empty use it; else try playlist cache
        function renderLessons(lessons){
            lessonsList.innerHTML = '';
            lessons.forEach((lsn, idx)=>{
                const row = document.createElement('div');
                row.className = 'lesson-item';
                row.setAttribute('data-lesson-id', lsn.id);
                row.style.cssText = 'display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid #eee;cursor:pointer';
                row.innerHTML = `<div style="display:flex;align-items:center;gap:10px"><i class="fas fa-play"></i><span>${lsn.title}</span></div><span style="opacity:.7">${lsn.duration || ''}</span>`;
                row.addEventListener('click', ()=>play(lsn));
                lessonsList.appendChild(row);
                if (idx===0) play(lsn);
            });
        }

        if (course.lessons && course.lessons.length) {
            renderLessons(course.lessons);
        } else {
            try {
                const cacheRaw = localStorage.getItem('courseLessons');
                const cache = cacheRaw ? JSON.parse(cacheRaw) : {};
                const cached = cache[id];
                if (cached && cached.length) {
                    renderLessons(cached);
                } else {
                    // Fallback: embed the playlist directly if present
                    if (course.playlistId && player) {
                        player.src = `https://www.youtube.com/embed/videoseries?list=${course.playlistId}`;
                        lessonTitle.textContent = 'ูุงุฆูุฉ ุชุดุบูู ุงูููุชููุจ';
                    }
                }
            } catch(_) {}
        }

        // Start exam handler
        const startExamBtn = document.getElementById('startExamBtn');
        if (startExamBtn) {
            startExamBtn.addEventListener('click', () => {
                // Choose exam title based on course id
                const title = (id === 'calculus') ? 'ุงูุชุญุงู ุดุงูู ุชูุงุถู ู ุชูุงูู' : 'ุงูุชุญุงู ุงูุชูุงุถู ู ุงูุชูุงูู';
                const duration = 60;
                if (!localStorage.getItem('user')) {
                    if (window.showAuthModal) window.showAuthModal('login');
                    else if (window.showNotification) window.showNotification('ุณุฌูู ุงูุฏุฎูู ุฃููุงู ูุจุฏุก ุงูุงูุชุญุงู', 'error');
                    return;
                }
                const params = new URLSearchParams({ course: id, title, duration: String(duration) });
                window.location.href = `exam.html?${params.toString()}`;
            });
        }

        
    })();
    </script>
</body>
</html>

