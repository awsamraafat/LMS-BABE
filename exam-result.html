<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نتيجة الامتحان - منصة محمود يس</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo"><i class="fas fa-graduation-cap"></i><span>منصة محمود يس</span></div>
            <div class="nav-actions"><a class="btn btn-outline" href="dashboard.html">الرجوع للوحة التحكم</a></div>
        </div>
    </nav>

    <section class="courses" style="padding-top:110px">
        <div class="container">
            <div class="section-header">
                <h2 id="resultTitle" class="section-title">نتيجة الامتحان</h2>
                <p class="section-subtitle" id="scoreLine"></p>
            </div>

            <div class="content-card">
                <div class="card-header"><h3>التصحيح</h3></div>
                <div class="card-body" id="details"></div>
                <div style="padding:16px;display:flex;gap:10px;justify-content:flex-end">
                    <a id="backToCourse" class="btn btn-outline" href="dashboard.html"><i class="fas fa-arrow-right"></i> الرجوع</a>
                </div>
            </div>
        </div>
    </section>

    <script src="script.js"></script>
    <script src="exams.js"></script>
    <script>
    (function(){
        const params = new URLSearchParams(window.location.search);
        const title = params.get('title') || 'امتحان';
        const course = params.get('course') || 'basic-math';
        const score = parseInt(params.get('score') || '0', 10);
        const total = parseInt(params.get('total') || '0', 10);
        const detailsParam = params.get('details') || '';
        const titleEl = document.getElementById('resultTitle');
        const scoreLine = document.getElementById('scoreLine');
        const detailsEl = document.getElementById('details');
        const backBtn = document.getElementById('backToCourse');
        if (titleEl) titleEl.textContent = `نتيجة: ${title}`;
        if (scoreLine) scoreLine.textContent = `درجتك: ${score}/${total} (${total?Math.round((score/total)*100):0}%)`;
        if (backBtn) backBtn.href = `course-detail.html?id=${encodeURIComponent(course)}`;

        const parsed = detailsParam.split(',').filter(Boolean).map(s => {
            const [id, answer, correct] = s.split(':');
            return { id, answer: parseInt(answer,10), correct: parseInt(correct,10) };
        });
        detailsEl.innerHTML = '';
        const questionBank = (window.EXAMS && window.EXAMS[course] && window.EXAMS[course][title]) ? window.EXAMS[course][title] : [];
        const byId = {}; questionBank.forEach(q => { byId[q.id] = q; });
        parsed.forEach((d, idx) => {
            const row = document.createElement('div');
            row.style.cssText = 'padding:12px 0;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center';
            const isCorrect = d.answer === d.correct;
            const q = byId[d.id];
            let optionsHtml = '';
            if (q && Array.isArray(q.options)) {
                optionsHtml = '<div style="margin-top:8px">' + q.options.map((opt, oi) => {
                    const isUser = oi === d.answer;
                    const isKey = oi === d.correct;
                    const color = isKey ? '#27ae60' : (isUser && !isKey ? '#e74c3c' : '#333');
                    const icon = isKey ? '<i class="fas fa-check"></i>' : (isUser && !isKey ? '<i class="fas fa-times"></i>' : '');
                    return `<div style="display:flex;align-items:center;gap:8px;color:${color}">${icon}<span>${opt}</span></div>`;
                }).join('') + '</div>';
            }
            row.innerHTML = `
                <div style="flex:1; padding-inline-end:12px">
                    <div style="font-weight:700">سؤال ${idx+1}${q?': '+q.text:''}</div>
                    ${optionsHtml}
                </div>
                <div>${isCorrect?'<span style="color:#27ae60"><i class="fas fa-check-circle"></i> صحيح</span>':'<span style="color:#e74c3c"><i class="fas fa-times-circle"></i> خطأ</span>'}</div>
            `;
            detailsEl.appendChild(row);
        });
    })();
    </script>
</body>
</html>

